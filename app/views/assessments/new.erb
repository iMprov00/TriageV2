<% @title = "Оценка пациента: #{@patient.full_name}" %>

<div class="row">
  <div class="col">
    <div class="card">
      <div class="card-header">
        <h4 class="mb-0"><i class="bi bi-clipboard2-pulse"></i> Оценка пациента: <%= @patient.full_name %></h4>
      </div>
      <div class="card-body">
        <p class="text-muted">Заполните данные для определения приоритета по шкале MFTI</p>
        
        <form action="/assessments" method="post">
          <input type="hidden" name="patient_id" value="<%= @patient.id %>">
          
          <!-- Основные показатели матери -->
          <div class="card mb-3">
            <div class="card-header card-header-green">
              <h5 class="mb-0"><i class="bi bi-heart-pulse"></i> Основные показатели матери</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="heart_rate_mother" class="form-label">ЧСС матери (уд/мин)</label>
                    <input type="number" id="heart_rate_mother" name="heart_rate_mother" class="form-control" 
                           min="0" max="300" placeholder="60-100">
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="blood_pressure" class="form-label">Артериальное давление</label>
                    <input type="text" id="blood_pressure" name="blood_pressure" class="form-control" 
                           placeholder="120/80" pattern="\d{1,3}/\d{1,3}">
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="respiration_rate_mother" class="form-label">Частота дыхания (дых/мин)</label>
                    <input type="number" id="respiration_rate_mother" name="respiration_rate_mother" class="form-control" 
                           min="0" max="60" placeholder="12-20">
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="spo2" class="form-label">SpO₂ (%)</label>
                    <input type="number" id="spo2" name="spo2" class="form-control" 
                           min="0" max="100" step="0.1" placeholder="95-100">
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="temperature" class="form-label">Температура (°C)</label>
                    <input type="number" id="temperature" name="temperature" class="form-control" 
                           min="30" max="45" step="0.1" placeholder="36.6">
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="consciousness" class="form-label">Сознание</label>
                    <select id="consciousness" name="consciousness" class="form-control">
                      <option value="">Выберите состояние</option>
                      <option value="ясное">Ясное</option>
                      <option value="измененное">Измененное</option>
                      <option value="отсутствует">Отсутствует</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Показатели плода -->
          <div class="card mb-3">
            <div class="card-header card-header-green">
              <h5 class="mb-0"><i class="bi bi-heart"></i> Показатели плода</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="fetal_heart_rate" class="form-label">ЧСС плода (уд/мин)</label>
                    <input type="number" id="fetal_heart_rate" name="fetal_heart_rate" class="form-control" 
                           min="0" max="300" placeholder="110-160">
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="gestational_age" class="form-label">Срок беременности (недель)</label>
                    <input type="number" id="gestational_age" name="gestational_age" class="form-control" 
                           min="0" max="45" placeholder="40">
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="fetal_position" class="form-label">Положение плода</label>
                    <select id="fetal_position" name="fetal_position" class="form-control">
                      <option value="">Выберите положение</option>
                      <option value="головное">Головное</option>
                      <option value="тазовое">Тазовое</option>
                      <option value="поперечное">Поперечное</option>
                      <option value="другое аномальное">Другое аномальное</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="bloody_discharge" class="form-label">Кровянистые выделения</label>
                    <select id="bloody_discharge" name="bloody_discharge" class="form-control">
                      <option value="">Выберите вариант</option>
                      <option value="отсутствуют">Отсутствуют</option>
                      <option value="незначительные">Незначительные</option>
                      <option value="умеренные">Умеренные</option>
                      <option value="алые непрерывные">Алые непрерывные</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Акушерские данные -->
          <div class="card mb-3">
            <div class="card-header card-header-green">
              <h5 class="mb-0"><i class="bi bi-hospital"></i> Акушерские данные</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <div class="form-check mb-2">
                    <input type="checkbox" id="contractions" name="contractions" value="true" class="form-check-input">
                    <label for="contractions" class="form-check-label">Схватки</label>
                  </div>
                  <div class="form-check mb-2">
                    <input type="checkbox" id="water_breakage" name="water_breakage" value="true" class="form-check-input">
                    <label for="water_breakage" class="form-check-label">Отхождение вод</label>
                  </div>
                  <div class="form-check mb-2">
                    <input type="checkbox" id="irregular_contractions" name="irregular_contractions" value="true" class="form-check-input">
                    <label for="irregular_contractions" class="form-check-label">Нерегулярные схватки</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-check mb-2">
                    <input type="checkbox" id="multiple_pregnancy" name="multiple_pregnancy" value="true" class="form-check-input">
                    <label for="multiple_pregnancy" class="form-check-label">Многоплодная беременность</label>
                  </div>
                  <div class="form-check mb-2">
                    <input type="checkbox" id="placenta_previa" name="placenta_previa" value="true" class="form-check-input">
                    <label for="placenta_previa" class="form-check-label">Предлежание плаценты</label>
                  </div>
                  <div class="form-check mb-2">
                    <input type="checkbox" id="uterine_scar" name="uterine_scar" value="true" class="form-check-input">
                    <label for="uterine_scar" class="form-check-label">Рубец на матке</label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Неотложные состояния -->
          <div class="card mb-3">
            <div class="card-header card-header-green">
              <h5 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Неотложные состояния</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <div class="form-check mb-2">
                    <input type="checkbox" id="convulsions" name="convulsions" value="true" class="form-check-input">
                    <label for="convulsions" class="form-check-label">Судороги</label>
                  </div>
                  <div class="form-check mb-2">
                    <input type="checkbox" id="umbilical_cord_prolapse" name="umbilical_cord_prolapse" value="true" class="form-check-input">
                    <label for="umbilical_cord_prolapse" class="form-check-label">Выпадение пуповины</label>
                  </div>
                  <div class="form-check mb-2">
                    <input type="checkbox" id="delivering_baby" name="delivering_baby" value="true" class="form-check-input">
                    <label for="delivering_baby" class="form-check-label">Роды в процессе</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-check mb-2">
                    <input type="checkbox" id="reduced_fetal_movement" name="reduced_fetal_movement" value="true" class="form-check-input">
                    <label for="reduced_fetal_movement" class="form-check-label">Снижение шевеления плода</label>
                  </div>
                  <div class="form-check mb-2">
                    <input type="checkbox" id="acute_pain" name="acute_pain" value="true" class="form-check-input">
                    <label for="acute_pain" class="form-check-label">Острая боль</label>
                  </div>
                  <div class="form-group">
                    <label for="acute_pain_severity" class="form-label">Интенсивность боли (0-10)</label>
                    <input type="range" id="acute_pain_severity" name="acute_pain_severity" class="form-range" 
                           min="0" max="10" value="0">
                    <output for="acute_pain_severity" id="pain-severity-output" class="badge bg-primary">0</output>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row mt-4">
            <div class="col">
              <div class="btn-group-vertical btn-group-lg" role="group" style="gap: 12px;">
                <button type="submit" class="btn btn-main">
                  <i class="bi bi-check-circle"></i> Сохранить оценку
                </button>
                <a href="/patients/<%= @patient.id %>" class="btn btn-secondary">
                  <i class="bi bi-arrow-left"></i> Отмена
                </a>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const painSlider = document.getElementById('acute_pain_severity');
  const painOutput = document.getElementById('pain-severity-output');
  
  painSlider.addEventListener('input', function() {
    painOutput.textContent = this.value;
  });
  
  // Улучшаем UX для планшетов
  document.querySelectorAll('.form-control, .form-check-input').forEach(input => {
    input.addEventListener('focus', function() {
      this.style.borderColor = 'var(--main-color)';
    });
    input.addEventListener('blur', function() {
      this.style.borderColor = '';
    });
  });
});
</script>

<style>
/* Стили для зеленых заголовков */
.card-header-green {
  background: linear-gradient(135deg, var(--main-color) 0%, var(--main-color-dark) 100%) !important;
  color: white !important;
  border-bottom: none;
}

/* Улучшенные стили для кнопок */
.btn-group-vertical {
  width: 100%;
}

.btn-group-vertical .btn {
  border-radius: 8px !important;
  padding: 12px 20px;
  font-size: 16px;
  font-weight: 500;
  text-align: center;
  min-height: 54px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

/* Адаптивность для планшетов */
@media (max-width: 768px) {
  .btn-group-vertical .btn {
    min-height: 60px;
    font-size: 18px;
  }
}
</style>